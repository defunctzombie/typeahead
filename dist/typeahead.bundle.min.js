var Typeahead=function(){"use strict";function e(e,n){this.element=e,this.options={};for(var i in t)t.hasOwnProperty(i)&&(this.options[i]=n[i]||t[i]);return this.matcher=n.matcher||this.matcher,this.sorter=n.sorter||this.sorter,this.highlighter=n.highlighter||this.highlighter,this.updater=n.updater||this.updater,this.menu=document.createElement(this.options.menu),this.menu.classList.add("typeahead"),this.menu.classList.add("hidden"),document.body.appendChild(this.menu),this.listen()}var t={source:[],items:8,menu:"ul",item:"li",minLength:1,autoselect:!0},n=function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{left:t,top:n}},i=e.prototype;return i.constructor=e,i.active=function(){return this.menu.getElementsByClassName("active").item(0)},i.select=function(){var e=new Event("change.typeahead"),t=this.active();Object.keys(t.dataset).forEach(function(e){this.element.dataset[e]=t.dataset[e]},this),this.element.value=this.updater(t),this.element.dispatchEvent(e),this.hide()},i.updater=function(e){return e.dataset.value},i.show=function(){var e=this,t=0,i=n(e.element),s=e.element;for(i.height=e.element.offsetHeight;s=s.parentElement;){var r=e.element.tagName.toLowerCase();"html"!==r&&"body"!==r&&(t+=s.scrollTop)}var o=i.top+i.height-t,a="auto",u=i.left;return"above"===e.options.position?(o="auto",a=document.body.clientHeight-i.top+3+"px"):"right"===e.options.position?(o=o-e.element.offsetHeight+"px",u=i.left+e.element.offsetWidth):o+="px",e.menu.style.top=o,e.menu.style.bottom=a,e.menu.style.left=u+"px",e.menu.classList.remove("hidden"),e},i.hide=function(){return this.menu.classList.add("hidden"),this},i.shown=function(){return!this.menu.classList.contains("hidden")},i.lookup=function(){var e=this;return e.query=e.element.value,!e.query||e.query.length<e.options.minLength?e.shown()?e.hide():e:(e.options.source instanceof Function?e.options.source(e.query,e.process.bind(e)):e.process(e.options.source),e)},i.process=function(e){var t=this;return e=e.filter(t.matcher,t),e=t.sorter(e),e.length?void t.render(e.slice(0,t.options.items)).show():t.shown()?t.hide():t},i.matcher=function(e){var t="string"==typeof e?e:e.value;return~t.toLowerCase().indexOf(this.query.toLowerCase())},i.sorter=function(e){var t=[],n=[],i=[];return e.forEach(function(e){var s="string"==typeof e?e:e.value;s.toLowerCase().indexOf(this.query.toLowerCase())?~s.indexOf(this.query)?n.push(e):i.push(e):t.push(e)},this),t.concat(n,i)},i.highlighter=function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},i.render=function(e){var t=this;return e=e.map(function(e){var n=document.createElement(t.options.item),i=document.createElement("a");return"string"==typeof e?(n.dataset.value=e,i.innerHTML=t.highlighter(e)):(Object.keys(e).forEach(function(t){n.dataset[t]=e[t]}),i.innerHTML=t.highlighter(e.value)),n.appendChild(i),n}),t.options.autoselect&&e[0].classList.add("active"),t.menu.innerHTML="",e.forEach(function(e){t.menu.appendChild(e)}),t},i.next=function(){var e=this.active(),t=e.nextElementSibling;e.classList.remove("active"),t||(t=this.menu.getElementsByTagName(this.options.item).item(0)),t.classList.add("active")},i.prev=function(){var e=this.active(),t=e.previousElementSibling;if(e.classList.remove("active"),!t){var n=this.menu.getElementsByTagName(this.options.item);t=n.item(n.length-1)}t.classList.add("active")},i.listen=function(){var e=this,t=e.element;return t.addEventListener("blur",e.blur.bind(e)),t.addEventListener("keypress",e.keypress.bind(e)),t.addEventListener("keyup",e.keyup.bind(e)),t.addEventListener("keydown",e.keydown.bind(e)),e.menu.addEventListener("click",e.click.bind(e)),e.menu.addEventListener("mouseenter",e.mouseenter.bind(e)),e},i.move=function(e){var t=this;if(this.shown()){switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),t.prev();break;case 40:e.preventDefault(),t.next()}e.stopPropagation()}},i.keydown=function(e){this.suppressKeyPressRepeat=[40,38,9,13,27].indexOf(e.keyCode)>=0,this.move(e)},i.keypress=function(e){this.suppressKeyPressRepeat||this.move(e)},i.keyup=function(e){var t=this;switch(e.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown())return;t.select();break;case 27:if(!t.shown())return;t.hide();break;default:t.lookup()}e.stopPropagation(),e.preventDefault()},i.blur=function(){var e=this;setTimeout(function(){e.hide()},150)},i.click=function(e){e.stopPropagation(),e.preventDefault(),this.select()},i.mouseenter=function(e){this.active().classList.remove("active"),e.currentTarget.classList.add("active")},e}();